## Оптимизация топологии в ACELAN

В пакете ACELAN-COMPOS реализована оптимизация топологии методом [ESO](/Developers/OptimizationESO.md). 
Основной процесс реализован в классе `EvolutionaryStructuralOptimization`, в нем функция `ESO` получает модель и данные для ее оптимизации (`topOptConfig`).

`topOptConfig` содержит:
- максимальное количество итераций (`maxN`), 
- процент удаляемого материала (`targetVolume`), 
- количество элементов для удаления за один шаг (`elemForStep`), 
- наименование функции для оценки чувствительности элемента (`senseName`).

Изначально все элементы сетки являются твердыми телами. 
В процессе оптимизации для каждого элемента оценивается его чувствительность.
В элементах с минимальными значениями материал заменяется воздухом.
Для определения функции оценки чувствительности используется интерфейс `ISensable`.

Элемент может оцениваться через:
- Деформации (`SingleDeformationSense`),
- Напряжения (`SingleStressSense`),
- Осредненные деформации (`AverageDeformationSense`),
- Осредненные напряжения (`AverageStressSense`),
- Перемещения (`SingleMovement`).

Узлы на которые наложены граничные условия закрепляются, а элементы содержащие эти узлы не подлежат удалению.

### Результаты

Результатом оптимизации является набор файлов:

- `"DataForTests/optimization_block_{elemRemove}.nas"`
> Файлы в формате .nas для экспорта в COMSOL (`nastranExporter.cs`). 
Создаются на каждом шаге оптимизации.

- `"DataForTests/optimization_block_{elemRemove}.json"`
> Создаются на каждом шаге оптимизации (`TopOptSolution.cs`).
Содержат информацию об узлах, элементах, полученных перемещениях, деформациях и напряжениях в каждом элементе.
Схема записи: `JsonTopologySolution.json` 

- `"DataForTests/optimization_block_steps_{n}.json"`
> Создаются на каждом шаге оптимизации (`TopOptSteps.cs`).
Содержат номер шага, время, значение чувствительности всей модели, оставшийся объем. 
Для каждого элемента: номер узла, значение чувствительности элемента и информацию о его существовании.
Схема записи: `JsonTopologySteps.json`

- `"DataForTests/optimization_block_steps.json"`
> Файл содержит информацию о методе оценки чувствительности элементов, максимальном числе шагов оптимизации,
проценте удаляемого материала, и количестве удаляемых за 1 шаг элементов. 
А также информацию о всех этапах оптимизации, которая
заполняется на каждом шаге из файлов `"optimization_block_steps_{n}.json"`.
Для заполнения файла реализован интерфейс `ITopologyLogger`, который определяет этапы записи файла.
Схема записи: `OptimizationBlockSteps.json`

### Тестирование

Реализованы тесты TopOptTest.cs для модели пластины из пакета COMSOL ([Оптимизация топологии в COMSOL](/Tutorials/TopologyOptimization.md)). 
Полученные результаты оптимизации хранятся в
`acelan\Acelan.Tests\bin\Debug\net7.0\DataForTests` 